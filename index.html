<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- このファイル自体をShift_JISで保存することを前提としています -->
    <meta charset="Shift_JIS">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>筑肥線 列車位置表示（Shift_JIS版）</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            font-family: sans-serif;
            overflow: hidden;
        }
        #info-bar {
            background: #e60012;
            color: white;
            padding: 8px 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }
        #view-area {
            background: white;
            padding: 10px;
            overflow: auto;
            text-align: center;
        }
        .train-no {
            color: #e60012;
            font-weight: bold;
            display: block;
        }
        /* 不要な公式パーツを消す */
        #headerArea, .header_menu, #footerArea { display: none !important; }
    </style>
</head>
<body>

<div id="info-bar">
    <span>筑肥線 列車位置（Shift_JIS版）</span>
    <span id="update-time">--:--:--</span>
</div>

<div id="view-area">
    <div id="contents">読み込み中...</div>
</div>

<script>
    const TARGET = 'https://george-doredore.jrkyushu.co.jp/jrqSEN9.html';
    const PROXY = (u) => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`;

    async function update() {
        try {
            const res = await fetch(PROXY(TARGET));
            const buffer = await res.arrayBuffer();
            
            // ファイルがShift_JISなら、取得データもShift_JISとして扱うのが一番自然
            const decoder = new TextDecoder('shift_jis');
            const html = decoder.decode(buffer);
            
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // 列車番号を表示する最小限の処理
            doc.querySelectorAll('td[title]').forEach(td => {
                const no = td.getAttribute('title');
                if (no && /\d/.test(no) && td.getAttribute('background')?.includes('image/M')) {
                    const img = td.querySelector('img');
                    td.innerHTML = `<div>${img ? img.outerHTML : ''}<span class="train-no">${no}</span></div>`;
                }
            });

            const main = doc.getElementById('contentsArea');
            if (main) {
                document.getElementById('contents').innerHTML = main.innerHTML;
                document.getElementById('update-time').innerText = new Date().toLocaleTimeString();
            }
        } catch (e) {
            console.error("更新失敗");
        }
    }

    update();
    setInterval(update, 15000);
</script>
</body>
</html>
